# us_stk_past_png_yr.r

# Using 2012 as a pattern,
# I use this script to plot some data generated by this sql script:
# us_stk_past_yr.sql 2012
# Which should be here:
# /tmp/us_stk_sunday_l_2012.csv
# /tmp/us_stk_sunday_s_2012.csv
# I intend to run this script on each Sunday.

args <- commandArgs()

yr = args[4]
print(yr)

# Define the .png file which will hold the output:
png_file1 = paste("/tmp/us_stk_sunday", yr,     sep="") 
png_file  = paste(png_file1,            ".png", sep="") 
print(png_file)
png(png_file,width = 900, height = 700)

# Get the bearish data:
bearish_csv1 = paste("/tmp/us_stk_sunday_s_", yr, sep="")
bearish_csv = paste(bearish_csv1, ".csv", sep="")
print(bearish_csv)
us_stk_sunday_s = read.csv(bearish_csv)

# Get the bullish data:
bullish_csv1 = paste("/tmp/us_stk_sunday_l_", yr, sep="")
bullish_csv = paste(bullish_csv1, ".csv", sep="")
print(bullish_csv)
us_stk_sunday_l = read.csv(bullish_csv)

# Tick labels perp to each axis
ytl_perp = 2
xtl_perp = 2

# Control the margin:
par()$mar
par(mar=c(6.2, 4.1, 4.1, 2.1))

plot(us_stk_sunday_s$WEEK_OF, us_stk_sunday_s$CUM_SUM
  ,main = "Weekly Performance of DanBot US Stock Predictions (Green = Bullish, Red = Bearish)"
  ,ylab = "US Dollars"
  ,ylim = c(-13000, 13000)
  ,las = ytl_perp
  ,type = "n"
)

# Connect the dots:
lines(us_stk_sunday_s$WEEK_OF, us_stk_sunday_s$CUM_SUM
  ,type = "o"
  ,col="red"
)

# Now overlay another plot:
# http://pj.freefaculty.org/R/Rtips.html#5.11
par(new = TRUE) 

# Now I plot the bullish predictions.

plot(us_stk_sunday_l$WEEK_OF, us_stk_sunday_l$CUM_SUM
  ,xaxt = 'n'
  ,yaxt = 'n'
  ,type = "n"
  ,ylab = " "
  ,xlab = " "
  ,ylim = c(-13000, 13000)
)

# Connect the dots:
lines(us_stk_sunday_l$WEEK_OF, us_stk_sunday_l$CUM_SUM
  ,type = "o"
  ,col="green"
)

grid(nx = 10, col = "blue")

dev.off()
